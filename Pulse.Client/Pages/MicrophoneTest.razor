@page "/MicrophoneTest"
@using Pulse.Client.Audio
<h3>MicrophoneTest</h3>
<MudFab Color="Color.Primary" OnClick="Test" Label="Test!" StartIcon="@Icons.Material.Filled.Speaker"/>

@code {

    private async Task Test()
    {
        var ctx = new CancellationTokenSource();
        var microphone = new Microphone();
        var speaker = new Speaker();
        // record for 5 seconds and then loop it back
        var stream = new MemoryStream();
        _ = microphone.RecordAsync(stream, ctx.Token);
        await Task.Delay(3000);
        stream.Position = 0;
        await speaker.PlayAsync(stream);
        ctx.Cancel();
    }
}